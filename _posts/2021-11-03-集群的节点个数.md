---
layout: post
title: "集群的节点个数为什么是奇数？？？"
author: "lnyyj"
header-img: "img/post-bg-halting.jpg"
header-mask: 0.3
tags:
  - 集群
  - 副本集
---


# 集群的节点个数为什么是奇数？？？

- 1. 节约资源
- 2. 防止集群脑裂


## 节省资源：
其主要原因还是从成本上考虑的，因为奇数个节点和偶数个节点允许宕机的节点数是一样的，比如3个节点和4个节点都只允许宕机一台，那么为什么要搞4个节点去浪费服务资源呢？

### 三个节点的情况
    现有三个节点A，B，C, 其中A是主节点

- 情况一：坏了一个节点

    如果是A节点坏了，就需要从B和C里面选举一个节点出来作为主节点，而因为B和C占比在集群中个占33.333%。那么投票会有以下四种情况和对应结果

    - B和C都投给自己，各占比33.33%，不满足超过半数的约定，重新选举
    - B和C都投给对方，各占比33.33%，不满足超过半数的约定，重新选举
    - B投给自己，C投给了B，B被选举为主节点，系统恢复运行
    - C投给自己，B投给了C，C被选举为主节点，系统恢复运行
    
    可以看到，只要投票次数足够多，总能从B或者C中选举出来一个主节点，系统总是能够自动恢复的。
    
- 情况二：坏了两个节点

    假设A和B或者A和C都坏了，剩下的一个节点占比只有33.333%。那么他是没法选举自己为主节点的，整个系统也是没法恢复正常的。

### 四个节点的情况

    现有三个节点A，B，C, D。 其中A是主节点
    
- 情况一：坏了一个节点

    如果是A节点坏了，就需要从B和C和D里面选举一个节点出来作为主节点，而因为B和C和D占比在集群中个占25%%。那么投票会有以下几种情况和对应结果
    
    - B和C和D都投给自己，各占比25%，不满足超过半数的约定，重新选举
    - B和C和D都投给对方，各占比25%%，不满足超过半数的约定，重新选举
    - C和D投给了B，B投给了C。B占比50%,C占比25%。还是没有节点满足超过半数的约定，重新选举
    - C和D投给了B，B投给了自己，B占比75%。B被选举为主节点，整个系统恢复正常
    其他情况也是类似的

- 情况二：坏了两个节点

    - 如果是A和B坏了，剩下的C和D投票最多只能投到50%。不满足超过半数的约定，系统无法恢复正常。

## 防止脑裂造成集群不可用
上图集群中如果由于通信问题，使左侧与右侧失去联系，而同侧集群可以正常运行。此时由于只有只有7/2 + 1 = 4个节点投同一个节点时，才能选举出master。所以左侧集群还是可用的。不管如何划分，奇数个集群总是可用的。
如果集群改为偶数个，假设是6个，如果三个集群“失联”，则直接就导致，剩下的3个集群无法选举出master，导致集群不可用！

作者：撸完代码送快递
链接：https://www.jianshu.com/p/80ca543079e8
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。