---
layout: post
title: "mongo 主从同步"
subtitle: 'mongo 主从同步调研，同步慢等'
author: "lnyyj"
header-img: "img/post-bg-halting.jpg"
header-mask: 0.3
tags:
  - mongo
  - 副本集
---

# mongo


local库下的每个集合分别记录的内容
local库下面的me集合保存了服务器名称
local库下面的replset.minvalid集合保存了数据库最新操作的时间戳
local库下面的startup_log集合记录这mongod每一次的启动信息
local库下面的system.indexes集合记录当前库的所有索引信息
local库下面的system.replset记录着复制集的成员配置信息rs.conf()读取这个集合


local库下面的oplog.rs集合记录着所有操作，MongoDB就是通过oplog.rs来实现数据同步的。当Primary节点插入一条数据后，oplog.rs集合中就会多一条记录




op：操作类型，插入对应i；更新对应u；删除对应d；但有一种情况是n，它表示无操作（no-op），紧紧代表一个消息信息。


db.oplog.rs.find({"ns":"order.order", "o._id":ObjectId("616254411d0690000be79354")}).limit(10)


db.oplog.rs.find({"ts":Timestamp(1633834049, 9)})




db.oplog.rs.stats()

db.version()


rs.status()

rs.isMaster()



## oplog同步慢
https://developer.aliyun.com/article/47336


## 参考资料

engin介绍: https://www.sohu.com/a/314591047_610509
复制详解: https://mongoing.com/archives/72571